define(["exports","jquery","TYPO3/CMS/Backend/Modal","TYPO3/CMS/Core/Ajax/AjaxRequest","TYPO3/CMS/Backend/Severity"],(function(e,t,a,s,l){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=n(t),i=n(a),r=n(s),o=n(l);const c=new class{constructor(){this.bindListener()}bindListener(){d.default(".content-type-switches a").on("click",this.onContentTypeSwitchClick.bind(this)),d.default("button[data-delete]").on("click",this.onDeleteButtonClick.bind(this)),d.default("#delete-all-messages").on("click",this.onDeleteAllMessagesClick.bind(this)),d.default(".panel").on("click",this.onPanelClick.bind(this))}onPanelClick(e){const t="true"===d.default(e.currentTarget).attr("data-html-loaded");if(d.default('.content-type-switches a[data-content-type="html"]:first-child',e.currentTarget).length&&!t){const t=d.default(e.currentTarget).attr("data-message-file");this.loadHtmlMail(t)}}onDeleteAllMessagesClick(e){e.preventDefault();const t=this;i.default.confirm("Delete Messages","Are you sure, you want to delete all messages?",o.default.warning,[{text:"Yes, delete",btnClass:"btn-danger",trigger:function(){t.deleteAllMessages(),i.default.dismiss()}},{text:"No, abort",btnClass:"btn-default",active:!0,trigger:function(){i.default.dismiss()}}])}deleteAllMessages(){const e=this,t=d.default(".panel[data-message-file]");new r.default(TYPO3.settings.ajaxUrls.mailcatcher_delete_all).get().then((async function(a){if((await a.resolve()).success)return t.remove(),e.refreshMessageCount(),void top.TYPO3.Notification.success("Success","All messages have been deleted",3);top.TYPO3.Notification.error("Error","Could not delete messages",3)}))}refreshMessageCount(){const e=d.default(".panel[data-message-file]").length;d.default("*[data-message-count]").attr("data-message-count",e),d.default(".message-count").html(e.toString())}onDeleteButtonClick(e){e.preventDefault();const t=d.default(e.currentTarget).closest(".panel"),a=t.attr("data-message-file"),s=this;new r.default(TYPO3.settings.ajaxUrls.mailcatcher_delete).withQueryArguments({messageFile:a}).get().then((async function(e){if((await e.resolve()).success)return t.remove(),void s.refreshMessageCount();top.TYPO3.Notification.error("Error","Could not delete message",3)}))}onContentTypeSwitchClick(e){e.preventDefault();const t=d.default(e.currentTarget).attr("data-content-type"),a=d.default(e.currentTarget).attr("data-m-id");d.default('.content-type-switches a[data-m-id="'+a+'"]').addClass("btn-default").removeClass("btn-primary"),d.default('.content-type-switches a[data-m-id="'+a+'"][data-content-type="'+t+'"]').removeClass("btn-default").addClass("btn-primary"),d.default('.form-section[data-m-id="'+a+'"]').addClass("hidden");d.default('.form-section[data-m-id="'+a+'"][data-content-type="'+t+'"]').removeClass("hidden");const s=d.default(e.currentTarget).closest(".panel");"false"===s.attr("data-html-loaded")&&"html"===t&&this.loadHtmlMail(s.attr("data-message-file"))}loadHtmlMail(e){new r.default(TYPO3.settings.ajaxUrls.mailcatcher_html).withQueryArguments({messageFile:e}).get().then((async function(t){const a=await t.resolve(),s=d.default("<iframe />").attr("width","100%").attr("frameBorder","0").attr("height","668px").attr("srcdoc",a.src);d.default('.panel[data-message-file="'+e+'"] .form-section[data-content-type="html"]').html(s),d.default('.panel[data-message-file="'+e+'"]').attr("data-html-loaded","true")})).catch((()=>{d.default('.panel[data-message-file="'+e+'"] .form-section[data-content-type="html"]').html('<div class="callout callout-danger">Could not load message</div>')}))}};e.XmMailCatcher=c,Object.defineProperty(e,"__esModule",{value:!0})}));
