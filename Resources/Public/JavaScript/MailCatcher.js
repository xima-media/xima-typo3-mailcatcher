define(["exports","jquery","TYPO3/CMS/Backend/Modal","TYPO3/CMS/Core/Ajax/AjaxRequest","TYPO3/CMS/Backend/Severity"],(function(e,t,a,s,l){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=n(t),r=n(a),d=n(s),c=n(l);const o=new class{constructor(){this.bindListener()}bindListener(){i.default(".content-type-switches a").on("click",this.onContentTypeSwitchClick.bind(this)),i.default("button[data-delete]").on("click",this.onDeleteButtonClick.bind(this)),i.default("#delete-all-messages").on("click",this.onDeleteAllMessagesClick.bind(this)),i.default(".panel").on("click",this.onPanelClick.bind(this))}onPanelClick(e){const t="true"===i.default(e.currentTarget).attr("data-html-loaded");if(i.default('.content-type-switches a[data-content-type="html"]:first-child',e.currentTarget).length&&!t){const t=i.default(e.currentTarget).attr("data-message-file");this.loadHtmlMail(t)}}onDeleteAllMessagesClick(e){e.preventDefault();const t=this;r.default.confirm(TYPO3.lang["js.delete.button"],TYPO3.lang["js.delete.message"],c.default.warning,[{text:TYPO3.lang["js.delete.yes"],btnClass:"btn-danger",trigger:function(){t.deleteAllMessages(),r.default.dismiss()}},{text:TYPO3.lang["js.delete.no"],btnClass:"btn-default",active:!0,trigger:function(){r.default.dismiss()}}])}deleteAllMessages(){const e=this,t=i.default(".panel[data-message-file]");new d.default(TYPO3.settings.ajaxUrls.mailcatcher_delete_all).get().then((async function(a){if((await a.resolve()).success)return t.remove(),e.refreshMessageCount(),void top.TYPO3.Notification.success(TYPO3.lang["js.success.headline"],TYPO3.lang["js.success.text"],3);top.TYPO3.Notification.error(TYPO3.lang["js.error.headline"],TYPO3.lang["js.error.text"],3)}))}refreshMessageCount(){const e=i.default(".panel[data-message-file]").length;i.default("*[data-message-count]").attr("data-message-count",e),i.default(".message-count").html(e.toString())}onDeleteButtonClick(e){e.preventDefault();const t=i.default(e.currentTarget).closest(".panel"),a=t.attr("data-message-file"),s=this;new d.default(TYPO3.settings.ajaxUrls.mailcatcher_delete).withQueryArguments({messageFile:a}).get().then((async function(e){if((await e.resolve()).success)return t.remove(),s.refreshMessageCount(),void top.TYPO3.Notification.success(TYPO3.lang["js.success.headline"],TYPO3.lang["js.success.text2"],3);top.TYPO3.Notification.error(TYPO3.lang["js.error.headline"],TYPO3.lang["js.error.text2"],3)}))}onContentTypeSwitchClick(e){e.preventDefault();const t=i.default(e.currentTarget).attr("data-content-type"),a=i.default(e.currentTarget).attr("data-m-id");i.default('.content-type-switches a[data-m-id="'+a+'"]').addClass("btn-default").removeClass("btn-primary"),i.default('.content-type-switches a[data-m-id="'+a+'"][data-content-type="'+t+'"]').removeClass("btn-default").addClass("btn-primary"),i.default('.form-section[data-m-id="'+a+'"]').addClass("hidden");i.default('.form-section[data-m-id="'+a+'"][data-content-type="'+t+'"]').removeClass("hidden");const s=i.default(e.currentTarget).closest(".panel");"false"===s.attr("data-html-loaded")&&"html"===t&&this.loadHtmlMail(s.attr("data-message-file"))}loadHtmlMail(e){new d.default(TYPO3.settings.ajaxUrls.mailcatcher_html).withQueryArguments({messageFile:e}).get().then((async function(t){const a=await t.resolve(),s=i.default("<iframe />").attr("width","100%").attr("frameBorder","0").attr("height","668px").attr("srcdoc",a.src);i.default('.panel[data-message-file="'+e+'"] .form-section[data-content-type="html"]').html(s),i.default('.panel[data-message-file="'+e+'"]').attr("data-html-loaded","true")})).catch((()=>{i.default('.panel[data-message-file="'+e+'"] .form-section[data-content-type="html"]').html('<div class="callout callout-danger">'+TYPO3.lang["js.error.text3"]+"</div>")}))}};e.XmMailCatcher=o,Object.defineProperty(e,"__esModule",{value:!0})}));
